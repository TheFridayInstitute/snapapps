<!DOCTYPE html>
<html>
    <head>
        <title>Login Page</title>
        <script src="isnap/lib/jquery-3.1.1.min.js?v=2.5.1-e1.1"></script>
        <script src="isnap/lib/jquery-ui-1.12.1/jquery-ui.min.js?v=2.5.1-e1.1"></script>
        <link rel="stylesheet" type="text/css" href="logging/login/assignment.css">
		<link rel="stylesheet" type="text/css" href="logging/login/css/font-awesome.min.css">
		<script type="text/javascript" src="morphic.js?v=2.4.9"></script>
        <script type="text/javascript" src="cloud.js?v=2.4.9"></script>
		<script type="text/javascript" src="sha512.js?v=2.4.9"></script>
    </head>
    <body>

        <div id="flex-Parent">
                <div id="blackBar"><div><img id="headerLogo"></div> <div><span id="courseName"> </span></div></div>
                <div id="theBox">
                    <div id="needsCookiesEnabled" class="hidden"><i class="fa fa-exclamation-circle fa-2x" aria-hidden="true"></i><span>Wrong user name or password. Please try again.</span></div>
                    <div id="theBorder">
                        <div id="logout" class="getFlex"> <div id="back-arrow"><a href="#" onclick="logout()"><i class="fa fa-long-arrow-left fa-3x" aria-hidden="true"></i></a></div></div>
                        <!-- <div id="snapLogo"><img src="login/SnapLogo.png"></img></div> -->
                        <div class="container">
                            <div class="belt-container">
                                <div class="belt">
                                    <div class="state state-1">
                                        <div>
                                            <img id="infusing-logo" src="infusing-pic.png">
                                            <h1 id="unityID-instruction">Sign in with Snap Account</h1>
                                            <div id="unityID-hint"> ( This is assigned by teacher )</div>
                                        </div>
                                        <div id="form-id">
                                            <form id="form-flex-Parent">
                                                <input id="input-id" name="id" placeholder="Enter User Name" required pattern="[A-Za-z0-9_]+" autofocus>
                                                <input id="input-pwd" name="pwd" placeholder="Enter Password" required type="password">
                                                <div id="confirm-new">
                                                    <!-- adding content based on if new user is allowed -->
                                                </div>
                                                <div><input type="submit" id="sign-in-Button" value="Next"></input></div>
                                            </form>
                                        </div>
                                    </div>
                                    <div class="state state-2">
                                        <div id="form-assignment">
                                            <div id="signed-in-as">Signed in as <span id="display-id-loggedIN"></span></div>
                                            <form action="snap.html" method="get">
                                                <h1>Select Teacher</h1>
                                                <div><select id="teacher" name="teacher" disabled></select></div>
                                                <h1>Select Assignment</h1>
                                                <div><select id="assignment" name="assignment" disabled></select></div>
                                                <div><button id="assignmentGObutton" type="submit" disabled>GO</button></div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        <!-- <h1>Welcome to our system!</h1>
        User name: <input type="text" id="username" placeholder="User Name" /> <br />
        Password: <input type="password" id="password" /> <br />
        <button type="submit" onclick=submit()>Sign In</button> -->

        <script type="text/javascript">
            function doLogin() {
                var user = {};
                user.username = $("#input-id").val();
                user.password = $('#input-pwd').val();
                user.persist = false;
                cloud.login(
                    user.username,
                    user.password,
                    user.persist,
                    function() {
                        sessionStorage.username=user.username;
                        $('#display-id-loggedIN').html(user.username);
                        $('#needsCookiesEnabled').addClass('hidden');
                        loadTeachers();
                        $('.belt-container').addClass('is-transitioned');
                    },
                    function() {
                        $('#needsCookiesEnabled').removeClass('hidden');
                    }
                )

                return false;
            }

            function loadTeachers() {
                var select = document.getElementById("teacher");
                var user_name = sessionStorage.username;

                var option = document.createElement("option");
                option.text = "Select one";
                option.value = "default";
                select.add(option);

                $.post('logging/login/getTeacher.php', {
					'user_name': user_name
				}, function(data, status) {
					var response;
					try {
                        response = JSON.parse(data);
					} catch(e) {
                        window.alert("json parse error");
						return;
                    }
                    response.forEach(teacher => {
                        option = document.createElement("option");
                        option.text = teacher.display_name;
                        option.value = teacher.user_id;
                        select.add(option);
                    });
                    $('#teacher').prop("disabled", false);
				}).fail(function() {
					window.alert("getTeacher post error");
				});
            }

            function loadAssignments() {
                var select = document.getElementById("assignment");
                var teacher = $("#teacher :selected").val();

                if (sessionStorage.username == "ydong2" && teacher == "catete") {
                    option = document.createElement("option");
                    option.text = "Draw Square Starter";
                    option.value = "Day1Activity1";
                    select.add(option);

                    option = document.createElement("option");
                    option.text = "Introduce Yourself Starter";
                    option.value = "Day1Activity2";
                    select.add(option);
                }
                $('#assignment').prop("disabled", false);
            }

            var cloud = new Cloud();
            cloud.logout();
            delete sessionStorage.username;

            $("#form-flex-Parent").submit(doLogin);
            $("#school").change(function() {
                loadTeachers();
            });
            $("#teacher").change(function() {
                loadAssignments();
            });
            $("#school").change(function() {
                $('#assignmentGObutton').prop("disabled", false);
            });
            $('#form-assignment')[0].action += document.location.hash;

        </script>
    </body>
</html>